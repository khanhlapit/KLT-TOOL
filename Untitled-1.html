<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>klt tools</title>
  <style>
    body{margin:0;font-family:system-ui,Segoe UI,Roboto,Arial;background:#2b1b10;color:#fff}
    .wrap{max-width:1100px;margin:0 auto;padding:16px}
    .top{display:flex;gap:14px;flex-wrap:wrap;align-items:center;justify-content:space-between}
    .title{font-weight:800}
    .small{opacity:.8;font-size:13px}
    .bar{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    input{width:70px;padding:8px;border-radius:10px;border:1px solid #ffffff2a;background:#1f120b;color:#fff}
    button{padding:8px 10px;border-radius:10px;border:1px solid #ffffff2a;background:#ffffff12;color:#fff;cursor:pointer}
    button:hover{background:#ffffff1b}

    /* palette */
    .palette{
      margin-top:14px;
      display:flex;gap:10px;flex-wrap:wrap;
      padding:12px;border-radius:14px;border:1px solid #ffffff2a;background:#00000022
    }
    .thumb{
      width:64px;height:64px;border-radius:12px;
      border:1px solid #ffffff2a;background:#ffffff10;
      overflow:hidden;cursor:grab
    }
    .thumb:active{cursor:grabbing}
    .thumb img{width:100%;height:100%;object-fit:cover;pointer-events:none}

    /* board */
    .board{
      margin-top:14px;
      padding:16px;border-radius:14px;border:1px solid #ffffff2a;background:#00000022;
      display:grid;gap:14px;
    }
    .cell{
      position:relative;
      border-radius:14px;
      border:1px solid #ffffff2a;
      background:#ffffff10;
      aspect-ratio: 1 / 1;
      overflow:hidden;
      display:grid;place-items:center;
    }
    .cell.dragover{outline:2px solid #ffd18a; background:#ffd18a18}
    .cell img{width:100%;height:100%;object-fit:cover}
    .idx{
      position:absolute;top:8px;left:8px;
      padding:4px 8px;border-radius:999px;
      background:#00000066;border:1px solid #ffffff2a;
      font-size:12px
    }
    .hint{opacity:.7;font-size:12px;margin-top:8px}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="top">
      <div>
        <div class="title">KKL TOOL</div>
        <div class="small">PHẦN MỀM HỖ TRỢ - BY DEV BÉ LẬP </div>
      </div>

      <div class="bar">
        <div>
          <div class="small">Hàng</div>
          <input id="rows" type="number" min="1" max="10" value="2" />
        </div>
        <div>
          <div class="small">Cột</div>
          <input id="cols" type="number" min="1" max="10" value="4" />
        </div>
        <button id="build">Tạo ô</button>
        <button id="clear">Xoá hết</button>
      </div>
    </div>

    <div class="palette" id="palette"></div>

    <div class="board" id="board"></div>
    <div class="hint">Tip: Thêm ảnh của bạn vào thư mục <b>assets/</b> rồi sửa mảng <b>IMAGES</b> trong code.</div>
  </div>

<script>
(() => {
  // 1) ĐỔI DANH SÁCH ẢNH Ở ĐÂY (ảnh nằm trong /assets/)
  const IMAGES = [
    "assets/01.png",
    "assets/02.png",
    "assets/03.png",
    "assets/04.png",
    "assets/05.png",
    "assets/06.png",
    "assets/07.png",
    
    // thêm nữa cũng được...
  ];

  const LS_KEY = "memory-helper-simple-v1";

  const els = {
    rows: document.getElementById("rows"),
    cols: document.getElementById("cols"),
    build: document.getElementById("build"),
    clear: document.getElementById("clear"),
    palette: document.getElementById("palette"),
    board: document.getElementById("board"),
  };

  let rows = 2, cols = 4, N = 8;
  let state = []; // state[i] = imageUrl or null

  function save(){
    localStorage.setItem(LS_KEY, JSON.stringify({rows, cols, state}));
  }
  function load(){
    try{
      const raw = localStorage.getItem(LS_KEY);
      if(!raw) return false;
      const data = JSON.parse(raw);
      rows = data.rows ?? 2;
      cols = data.cols ?? 4;
      N = rows*cols;
      state = Array.isArray(data.state) ? data.state.slice(0, N) : [];
      while(state.length < N) state.push(null);
      els.rows.value = rows;
      els.cols.value = cols;
      return true;
    }catch(e){ return false; }
  }

  function renderPalette(){
    els.palette.innerHTML = "";
    IMAGES.forEach(url => {
      const d = document.createElement("div");
      d.className = "thumb";
      d.draggable = true;
      d.addEventListener("dragstart", (e) => {
        e.dataTransfer.setData("text/img", url);
      });

      const img = document.createElement("img");
      img.src = url;
      img.alt = url;
      d.appendChild(img);
      els.palette.appendChild(d);
    });
  }

  function buildBoard(){
    rows = Math.max(1, Math.min(10, parseInt(els.rows.value,10) || 1));
    cols = Math.max(1, Math.min(10, parseInt(els.cols.value,10) || 1));
    els.rows.value = rows; els.cols.value = cols;

    const old = state.slice();
    N = rows*cols;
    state = Array(N).fill(null);
    for(let i=0;i<Math.min(old.length, N);i++) state[i] = old[i];

    renderBoard();
    save();
  }

  function renderBoard(){
    els.board.style.gridTemplateColumns = `repeat(${cols}, minmax(0, 1fr))`;
    els.board.innerHTML = "";

    for(let i=0;i<N;i++){
      const cell = document.createElement("div");
      cell.className = "cell";

      const idx = document.createElement("div");
      idx.className = "idx";
      idx.textContent = `Ô ${i+1}`;
      cell.appendChild(idx);

      const url = state[i];
      if(url){
        const img = document.createElement("img");
        img.src = url;
        img.alt = url;
        cell.appendChild(img);
      }else{
        const plus = document.createElement("div");
        plus.style.opacity = ".55";
        plus.style.fontWeight = "900";
        plus.style.fontSize = "22px";
        plus.textContent = "+";
        cell.appendChild(plus);
      }

      cell.addEventListener("dragover", (e) => { e.preventDefault(); cell.classList.add("dragover"); });
      cell.addEventListener("dragleave", () => cell.classList.remove("dragover"));
      cell.addEventListener("drop", (e) => {
        e.preventDefault();
        cell.classList.remove("dragover");
        const imgUrl = e.dataTransfer.getData("text/img");
        if(!imgUrl) return;
        state[i] = imgUrl;
        renderBoard();
        save();
      });

      // click to clear
      cell.addEventListener("click", () => {
        state[i] = null;
        renderBoard();
        save();
      });

      // right click to clear (desktop)
      cell.addEventListener("contextmenu", (e) => {
        e.preventDefault();
        state[i] = null;
        renderBoard();
        save();
      });

      els.board.appendChild(cell);
    }
  }

  function clearAll(){
    state = Array(N).fill(null);
    renderBoard();
    save();
  }

  els.build.addEventListener("click", buildBoard);
  els.clear.addEventListener("click", clearAll);

  // init
  const ok = load();
  if(!ok){
    rows = 2; cols = 4; N = 8;
    state = Array(N).fill(null);
    els.rows.value = rows; els.cols.value = cols;
  }
  renderPalette();
  renderBoard();
})();
</script>
</body>
</html>
